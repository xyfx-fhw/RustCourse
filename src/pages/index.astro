---
import { getCollection } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import Header from '@/components/layout/Header.astro';
import { groupByChapter, parseChapterName } from '@/lib/utils/courseLoader';
import type { CourseMetadata } from '@/types/course';

const base = import.meta.env.BASE_URL;

// è·å–æ‰€æœ‰è¯¾ç¨‹
const allCourses = await getCollection('courses');
const allCoursesMetadata: CourseMetadata[] = allCourses.map((c) => {
  const [ch, ls] = c.slug.split('/');
  const chInfo = parseChapterName(ch);
  return {
    ...c.data,
    slug: c.slug,
    chapter: ch,
    chapterTitle: chInfo.title,
    lesson: ls,
    url: `${base}/courses/${c.slug}`,
  };
});

const chapters = groupByChapter(allCoursesMetadata);
const totalLessons = allCoursesMetadata.length;
---

<BaseLayout>
  <Header />

  <main class="min-h-screen">
    <!-- Hero Section -->
    <section class="bg-gradient-to-br from-primary to-primary-dark text-white py-20">
      <div class="container mx-auto px-4 text-center">
        <h1 class="text-5xl md:text-6xl font-bold mb-6">
          ğŸ¦€ Rust äº’åŠ¨æ•™ç¨‹
        </h1>
        <p class="text-xl md:text-2xl mb-8 text-blue-100">
          ä»é›¶å¼€å§‹ï¼Œç³»ç»Ÿå­¦ä¹  Rust ç¼–ç¨‹è¯­è¨€
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a
            href={`${base}/courses/01-rust-basics/01-installation`}
            class="btn btn-secondary text-lg px-8 py-3 inline-block"
          >
            å¼€å§‹å­¦ä¹  â†’
          </a>
          <a
            href="#courses"
            class="btn bg-white/10 hover:bg-white/20 text-white text-lg px-8 py-3 inline-block"
          >
            æŸ¥çœ‹è¯¾ç¨‹
          </a>
        </div>
        <!-- ä½œè€…ä¿¡æ¯ -->
        <div class="mt-8 text-blue-100">
          <p class="text-sm">ä½œè€…ï¼šé›ªäº‘é£æ˜Ÿ</p>
        </div>
      </div>
    </section>

    <!-- ç‰¹æ€§ä»‹ç» -->
    <section class="py-16 bg-white">
      <div class="container mx-auto px-4">
        <div class="grid md:grid-cols-3 gap-8">
          <div class="text-center">
            <div class="text-4xl mb-4">ğŸ“š</div>
            <h3 class="text-xl font-bold mb-2">ç³»ç»ŸåŒ–å­¦ä¹ </h3>
            <p class="text-gray-600">ä»åŸºç¡€åˆ°è¿›é˜¶ï¼Œå¾ªåºæ¸è¿›çš„è¯¾ç¨‹ä½“ç³»</p>
          </div>
          <div class="text-center">
            <div class="text-4xl mb-4">ğŸ’¡</div>
            <h3 class="text-xl font-bold mb-2">å®è·µå¯¼å‘</h3>
            <p class="text-gray-600">æ¯èŠ‚è¯¾éƒ½æœ‰å®è·µç»ƒä¹ ï¼Œè¾¹å­¦è¾¹ç»ƒ</p>
          </div>
          <div class="text-center">
            <div class="text-4xl mb-4">âœ…</div>
            <h3 class="text-xl font-bold mb-2">è¿›åº¦è·Ÿè¸ª</h3>
            <p class="text-gray-600">è‡ªåŠ¨è®°å½•å­¦ä¹ è¿›åº¦ï¼Œéšæ—¶æŸ¥çœ‹</p>
          </div>
        </div>
      </div>
    </section>

    <!-- è¯¾ç¨‹åˆ—è¡¨ -->
    <section id="courses" class="py-16 bg-gray-50">
      <div class="container mx-auto px-4">
        <h2 class="text-3xl font-bold text-center mb-12">è¯¾ç¨‹å†…å®¹</h2>

        <div class="max-w-4xl mx-auto space-y-8">
          {chapters.map((chapter, index) => (
            <div class="card">
              <div class="flex items-start justify-between mb-4">
                <div>
                  <h3 class="text-2xl font-bold text-gray-900 mb-2">
                    ç¬¬ {index + 1} ç« ï¼š{chapter.title}
                  </h3>
                  <p class="text-gray-600">
                    å…± {chapter.lessons.length} èŠ‚è¯¾
                  </p>
                </div>
                <span class="text-3xl">ğŸ“–</span>
              </div>

              <ul class="space-y-2">
                {chapter.lessons.map((lesson, lessonIndex) => (
                  <li>
                    <a
                      href={lesson.url}
                      class="block p-3 rounded-lg hover:bg-gray-50 transition-colors group"
                    >
                      <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                          <span class="text-gray-400 font-medium">
                            {index + 1}.{lessonIndex + 1}
                          </span>
                          <span class="text-gray-900 group-hover:text-primary font-medium">
                            {lesson.title}
                          </span>
                        </div>
                        {lesson.duration && (
                          <span class="text-sm text-gray-500">
                            {lesson.duration} åˆ†é’Ÿ
                          </span>
                        )}
                      </div>
                      {lesson.description && (
                        <p class="text-sm text-gray-600 mt-1 ml-12">
                          {lesson.description}
                        </p>
                      )}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          ))}
        </div>

        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
        <div class="mt-12 text-center">
          <p class="text-gray-600">
            å…± <span class="font-bold text-primary">{chapters.length}</span> ç« 
            <span class="mx-2">|</span>
            <span class="font-bold text-primary">{totalLessons}</span> èŠ‚è¯¾ç¨‹
          </p>
        </div>
      </div>
    </section>

    <!-- CTA Section -->
    <section class="py-16 bg-primary text-white">
      <div class="container mx-auto px-4 text-center">
        <h2 class="text-3xl font-bold mb-4">å‡†å¤‡å¥½å¼€å§‹å­¦ä¹ äº†å—ï¼Ÿ</h2>
        <p class="text-xl text-blue-100 mb-8">
          ç°åœ¨å°±å¼€å§‹ä½ çš„ Rust å­¦ä¹ ä¹‹æ—…
        </p>
        <a
          href={`${base}/courses/01-rust-basics/01-installation`}
          class="btn btn-secondary text-lg px-8 py-3 inline-block"
        >
          å¼€å§‹ç¬¬ä¸€è¯¾ â†’
        </a>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-900 text-gray-400 py-8">
    <div class="container mx-auto px-4 text-center">
      <p>Â© 2024 Rust äº’åŠ¨æ•™ç¨‹ | ä½œè€…ï¼šé›ªäº‘é£æ˜Ÿ | ä½¿ç”¨ Astro æ„å»º</p>
    </div>
  </footer>
</BaseLayout>
